<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{TITLE}}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <style>
      :root {
        --bg-color: #ffffff;
        --text-color: #333333;
        --secondary-text: #666666;
        --border-color: #e0e0e0;
        --card-bg: #ffffff;
        --hover-bg: #f5f5f5;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.15);
        --code-bg: #f5f5f5;
        --btn-bg-transparent: rgba(255, 255, 255, 0.85);
        --btn-border-transparent: rgba(224, 224, 224, 0.6);
      }

      [data-theme="dark"] {
        --bg-color: #1a1a1a;
        --text-color: #e0e0e0;
        --secondary-text: #a0a0a0;
        --border-color: #333333;
        --card-bg: #242424;
        --hover-bg: #2d2d2d;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        --shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.7);
        --code-bg: #2d2d2d;
        --btn-bg-transparent: rgba(36, 36, 36, 0.75);
        --btn-border-transparent: rgba(51, 51, 51, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--bg-color);
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
        padding: 40px 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      /* ==================== 统一控制面板样式 ==================== */
      .control-panel {
        position: fixed;
        top: 30px;
        right: 30px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-end;
      }

      .control-buttons {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .control-btn {
        width: 50px;
        height: 50px;
        background: var(--btn-bg-transparent);
        border: 2px solid var(--btn-border-transparent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.3rem;
        color: var(--text-color);
        transition: all 0.3s ease;
        box-shadow: var(--shadow);
        position: relative;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .control-btn:hover {
        transform: scale(1.1);
        box-shadow: var(--shadow-hover);
        background: var(--card-bg);
        border-color: var(--border-color);
      }

      .control-btn i {
        transition: transform 0.3s ease;
      }

      .control-btn.active {
        background: var(--card-bg);
        border-color: var(--border-color);
      }

      .control-btn.active i {
        animation: musicPulse 1s ease-in-out infinite;
      }

      @keyframes musicPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
      }

      /* ==================== 自定义音乐播放器样式 ==================== */
      .music-panel {
        background: var(--card-bg);
        border: 2px solid var(--border-color);
        border-radius: 16px;
        padding: 16px;
        box-shadow: var(--shadow-hover);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 320px;
        max-width: 400px;
      }

      .music-panel.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      /* 音乐面板显示时，音乐按钮保持完全可见 */
      .control-panel:has(.music-panel.show) .control-btn {
        background: var(--card-bg);
        border-color: var(--border-color);
      }

      .music-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 16px;
      }

      .music-header i {
        font-size: 1.2rem;
        color: var(--text-color);
        flex-shrink: 0;
      }

      .music-title {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-color);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
      }

      /* 自定义音频播放器 */
      .custom-audio-player {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .audio-controls {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .play-btn {
        width: 40px;
        height: 40px;
        background: var(--text-color);
        color: var(--bg-color);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        flex-shrink: 0;
      }

      .play-btn:hover {
        opacity: 0.8;
        transform: scale(1.05);
      }

      .play-btn i {
        margin-left: 2px;
      }

      .play-btn.playing i {
        margin-left: 0;
      }

      .audio-time {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: var(--secondary-text);
        font-variant-numeric: tabular-nums;
        flex-shrink: 0;
      }

      .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: auto;
      }

      .volume-btn {
        background: none;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        font-size: 1.1rem;
        padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .volume-btn:hover {
        opacity: 0.7;
      }

      .progress-container {
        width: 100%;
        height: 6px;
        background: var(--border-color);
        border-radius: 3px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: var(--text-color);
        border-radius: 3px;
        width: 0%;
        transition: width 0.1s linear;
        position: relative;
      }

      .progress-bar::after {
        content: "";
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        background: var(--text-color);
        border-radius: 50%;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .progress-container:hover .progress-bar::after {
        opacity: 1;
      }

      /* 隐藏原生 audio 元素 */
      .music-panel audio {
        display: none;
      }

      /* ==================== Markdown 内容样式 ==================== */
      .markdown-content {
        background: var(--card-bg);
        padding: 50px;
        border-radius: 16px;
        box-shadow: var(--shadow);
        margin-bottom: 40px;
        border: 2px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .markdown-content h1,
      .markdown-content h2,
      .markdown-content h3,
      .markdown-content h4,
      .markdown-content h5,
      .markdown-content h6 {
        margin-top: 1.8em;
        margin-bottom: 0.9em;
        font-weight: 600;
        line-height: 1.3;
        color: var(--text-color);
        letter-spacing: -0.02em;
      }

      .markdown-content h1:first-child,
      .markdown-content h2:first-child,
      .markdown-content h3:first-child {
        margin-top: 0;
      }

      .markdown-content h1 {
        font-size: 2.5rem;
        font-weight: 700;
        border-bottom: 3px solid var(--text-color);
        padding-bottom: 0.5em;
        margin-bottom: 1.2em;
      }

      .markdown-content h2 {
        font-size: 2rem;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 0.4em;
      }

      .markdown-content h3 {
        font-size: 1.6rem;
      }

      .markdown-content h4 {
        font-size: 1.3rem;
      }

      .markdown-content h5 {
        font-size: 1.1rem;
      }

      .markdown-content h6 {
        font-size: 1rem;
        color: var(--secondary-text);
      }

      .markdown-content p {
        margin-bottom: 1.4em;
        line-height: 1.8;
      }

      .markdown-content a {
        color: var(--text-color);
        text-decoration: none;
        border-bottom: 1px solid var(--text-color);
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .markdown-content a:hover {
        opacity: 0.6;
      }

      .markdown-content ul,
      .markdown-content ol {
        margin-bottom: 1.4em;
        padding-left: 2em;
      }

      .markdown-content li {
        margin-bottom: 0.6em;
        line-height: 1.7;
      }

      .markdown-content li::marker {
        color: var(--text-color);
        font-weight: 600;
      }

      .markdown-content blockquote {
        border-left: 4px solid var(--text-color);
        padding: 1.2em 1.8em;
        margin: 1.8em 0;
        background: var(--code-bg);
        border-radius: 8px;
        color: var(--secondary-text);
        font-style: italic;
      }

      .markdown-content blockquote p:last-child {
        margin-bottom: 0;
      }

      .markdown-content code {
        background: var(--code-bg);
        padding: 0.2em 0.5em;
        border-radius: 4px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.9em;
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .markdown-content pre {
        background: var(--code-bg);
        padding: 1.5em;
        border-radius: 12px;
        overflow-x: auto;
        margin: 1.8em 0;
        border: 1px solid var(--border-color);
      }

      .markdown-content pre code {
        background: none;
        padding: 0;
        border: none;
        font-size: 0.95em;
      }

      .markdown-content img {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        margin: 2em 0;
        display: block;
        box-shadow: var(--shadow);
      }

      .markdown-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.8em 0;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--shadow);
      }

      .markdown-content table th,
      .markdown-content table td {
        border: 1px solid var(--border-color);
        padding: 0.9em 1.2em;
        text-align: left;
      }

      .markdown-content table th {
        background: var(--code-bg);
        font-weight: 600;
        color: var(--text-color);
      }

      .markdown-content table tr:hover {
        background: var(--code-bg);
        transition: background 0.2s ease;
      }

      .markdown-content hr {
        border: none;
        border-top: 2px solid var(--border-color);
        margin: 3em 0;
      }

      .markdown-content strong {
        font-weight: 600;
        color: var(--text-color);
      }

      .markdown-content em {
        font-style: italic;
        color: var(--secondary-text);
      }

      /* ==================== 解密界面样式 ==================== */
      .password-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(15px);
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .password-dialog {
        background: var(--card-bg);
        padding: 50px 40px;
        border-radius: 20px;
        box-shadow: var(--shadow-hover);
        max-width: 420px;
        width: 90%;
        text-align: center;
        animation: slideUp 0.4s ease;
        border: 2px solid var(--border-color);
      }

      @keyframes slideUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .password-icon {
        font-size: 3.5rem;
        color: var(--text-color);
        margin-bottom: 25px;
        display: block;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
      }

      .password-dialog h2 {
        margin-bottom: 12px;
        color: var(--text-color);
        font-size: 1.6rem;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .password-dialog p {
        color: var(--secondary-text);
        margin-bottom: 30px;
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .password-input-group {
        display: flex;
        gap: 12px;
        margin-bottom: 15px;
        align-items: stretch;
      }

      .password-input-group input {
        flex: 1;
        padding: 14px 18px;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        background: var(--bg-color);
        color: var(--text-color);
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: all 0.3s ease;
      }

      .password-input-group input:focus {
        border-color: var(--text-color);
        transform: translateY(-1px);
      }

      .password-input-group input::placeholder {
        color: var(--secondary-text);
        opacity: 0.6;
      }

      .password-input-group button {
        padding: 14px 24px;
        background: var(--text-color);
        color: var(--bg-color);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        font-family: inherit;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        white-space: nowrap;
        min-width: 100px;
        flex-shrink: 0;
      }

      .password-input-group button:hover {
        opacity: 0.8;
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }

      .password-input-group button:active {
        transform: translateY(0);
      }

      .password-input-group button i {
        font-size: 1.1rem;
        flex-shrink: 0;
      }

      .error-message {
        color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        display: none;
        margin-top: 15px;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border: 2px solid rgba(231, 76, 60, 0.3);
        animation: shake 0.5s ease;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .error-message i {
        font-size: 1.1rem;
      }

      .password-input-group button.loading {
        pointer-events: none;
        opacity: 0.7;
      }

      .password-input-group button.loading::after {
        content: "";
        width: 16px;
        height: 16px;
        border: 2px solid var(--bg-color);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        margin-left: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* ==================== 返回顶部按钮样式 ==================== */
      .back-to-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: var(--btn-bg-transparent);
        color: var(--text-color);
        border: 2px solid var(--btn-border-transparent);
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow);
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 999;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .back-to-top i {
        color: var(--text-color);
        font-size: 1.2rem;
      }

      .back-to-top.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .back-to-top.show:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: var(--shadow-hover);
        background: var(--card-bg);
        border-color: var(--border-color);
      }

      .back-to-top:hover i {
        animation: arrowUp 0.6s ease infinite;
      }

      @keyframes arrowUp {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-3px);
        }
      }

      /* ==================== 响应式优化 ==================== */
      @media (max-width: 768px) {
        body {
          padding: 20px 15px;
        }

        .control-panel {
          top: 20px;
          right: 20px;
        }

        .control-btn {
          width: 45px;
          height: 45px;
          font-size: 1.2rem;
        }

        .control-btn:hover,
        .control-btn:active {
          background: var(--card-bg);
          border-color: var(--border-color);
        }

        .control-btn.active {
          background: var(--card-bg);
          border-color: var(--border-color);
        }

        .music-panel {
          min-width: 280px;
          max-width: calc(100vw - 40px);
        }

        .markdown-content {
          padding: 35px 25px;
        }

        .markdown-content h1 {
          font-size: 2rem;
        }

        .markdown-content h2 {
          font-size: 1.6rem;
        }

        .markdown-content h3 {
          font-size: 1.4rem;
        }

        .back-to-top {
          bottom: 20px;
          right: 20px;
          width: 45px;
          height: 45px;
        }

        .back-to-top.show:hover,
        .back-to-top.show:active {
          background: var(--card-bg);
          border-color: var(--border-color);
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 15px 10px;
        }

        .control-panel {
          top: 15px;
          right: 15px;
        }

        .control-buttons {
          gap: 8px;
        }

        .control-btn {
          width: 42px;
          height: 42px;
          font-size: 1.1rem;
        }

        .control-btn:hover,
        .control-btn:active,
        .control-btn:focus {
          background: var(--card-bg);
          border-color: var(--border-color);
        }

        .control-btn.active {
          background: var(--card-bg);
          border-color: var(--border-color);
        }

        .music-panel {
          min-width: 260px;
          padding: 14px;
        }

        .music-header {
          margin-bottom: 14px;
        }

        .music-title {
          font-size: 0.85rem;
        }

        .play-btn {
          width: 36px;
          height: 36px;
          font-size: 1.1rem;
        }

        .audio-time {
          font-size: 0.8rem;
        }

        .password-dialog {
          padding: 40px 25px;
          border-radius: 16px;
        }

        .password-icon {
          font-size: 2.8rem;
          margin-bottom: 20px;
        }

        .password-dialog h2 {
          font-size: 1.4rem;
          margin-bottom: 10px;
        }

        .password-dialog p {
          font-size: 0.9rem;
          margin-bottom: 25px;
        }

        .password-input-group {
          flex-direction: column;
          gap: 10px;
        }

        .password-input-group input {
          padding: 12px 16px;
          width: 100%;
        }

        .password-input-group button {
          width: 100%;
          justify-content: center;
          padding: 12px 24px;
          min-width: unset;
        }

        .back-to-top {
          bottom: 15px;
          right: 15px;
          width: 42px;
          height: 42px;
          font-size: 1.1rem;
        }

        .back-to-top i {
          font-size: 1.1rem;
        }

        .back-to-top.show:hover,
        .back-to-top.show:active,
        .back-to-top.show:focus {
          background: var(--card-bg);
          border-color: var(--border-color);
        }

        .markdown-content {
          padding: 30px 20px;
          border-radius: 12px;
        }

        .markdown-content h1 {
          font-size: 1.8rem;
        }

        .markdown-content h2 {
          font-size: 1.5rem;
        }

        .markdown-content h3 {
          font-size: 1.3rem;
        }
      }

      @media (max-width: 380px) {
        .password-input-group button {
          font-size: 0.95rem;
          padding: 12px 20px;
        }

        .markdown-content {
          padding: 25px 15px;
        }
      }

      /* ==================== 触摸设备优化 ==================== */
      @media (hover: none) and (pointer: coarse) {
        .control-btn:active {
          background: var(--card-bg) !important;
          border-color: var(--border-color) !important;
          transition: all 0.1s ease;
        }

        .back-to-top.show:active {
          background: var(--card-bg) !important;
          border-color: var(--border-color) !important;
          transition: all 0.1s ease;
        }

        /* 触摸设备上增加点击区域 */
        .control-btn::before,
        .back-to-top::before {
          content: "";
          position: absolute;
          top: -10px;
          left: -10px;
          right: -10px;
          bottom: -10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="control-panel">
      {{MUSIC_PLAYER}}
      <div class="control-buttons">
        <button
          class="control-btn"
          onclick="toggleTheme()"
          aria-label="切换主题"
          id="themeBtn"
        >
          <i class="ri-moon-line"></i>
        </button>
      </div>
    </div>

    <div class="container">
      {{ENCRYPTION_DATA}}

      <article class="markdown-content">{{MARKDOWN_CONTENT}}</article>
    </div>

    <button class="back-to-top" onclick="scrollToTop()" aria-label="返回顶部">
      <i class="ri-arrow-up-line"></i>
    </button>

    <script>
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);

        const icon = document.querySelector("#themeBtn i");
        icon.className = newTheme === "light" ? "ri-moon-line" : "ri-sun-line";
      }

      const savedTheme = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", savedTheme);
      const icon = document.querySelector("#themeBtn i");
      icon.className = savedTheme === "light" ? "ri-moon-line" : "ri-sun-line";

      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      // 返回顶部按钮显示/隐藏
      window.addEventListener("scroll", () => {
        const backToTop = document.querySelector(".back-to-top");
        if (backToTop) {
          if (window.pageYOffset > 300) {
            backToTop.classList.add("show");
          } else {
            backToTop.classList.remove("show");
          }
        }
      });

      // 音乐播放器控制
      function toggleMusicPlayer() {
        const panel = document.querySelector(".music-panel");
        if (panel) {
          panel.classList.toggle("show");
        }
      }

      // 自定义音频播放器功能
      class CustomAudioPlayer {
        constructor(audioElement) {
          this.audio = audioElement;
          this.playBtn = document.querySelector(".play-btn");
          this.progressContainer = document.querySelector(
            ".progress-container",
          );
          this.progressBar = document.querySelector(".progress-bar");
          this.currentTimeEl = document.querySelector(".current-time");
          this.durationEl = document.querySelector(".duration");
          this.volumeBtn = document.querySelector(".volume-btn");
          this.musicBtn = document.querySelector("#musicBtn");

          this.isPlaying = false;
          this.isMuted = false;

          this.init();
        }

        init() {
          if (!this.audio) return;

          // 播放/暂停按钮
          this.playBtn.addEventListener("click", () => this.togglePlay());

          // 进度条点击
          this.progressContainer.addEventListener("click", (e) => this.seek(e));

          // 音量按钮
          this.volumeBtn.addEventListener("click", () => this.toggleMute());

          // 音频事件监听
          this.audio.addEventListener("loadedmetadata", () =>
            this.updateDuration(),
          );
          this.audio.addEventListener("timeupdate", () =>
            this.updateProgress(),
          );
          this.audio.addEventListener("ended", () => this.onEnded());
          this.audio.addEventListener("play", () => this.onPlay());
          this.audio.addEventListener("pause", () => this.onPause());
        }

        togglePlay() {
          if (this.isPlaying) {
            this.audio.pause();
          } else {
            this.audio.play();
          }
        }

        onPlay() {
          this.isPlaying = true;
          this.playBtn.classList.add("playing");
          this.playBtn.innerHTML = '<i class="ri-pause-line"></i>';
          if (this.musicBtn) {
            this.musicBtn.classList.add("active");
          }
        }

        onPause() {
          this.isPlaying = false;
          this.playBtn.classList.remove("playing");
          this.playBtn.innerHTML = '<i class="ri-play-fill"></i>';
          if (this.musicBtn) {
            this.musicBtn.classList.remove("active");
          }
        }

        onEnded() {
          this.isPlaying = false;
          this.playBtn.classList.remove("playing");
          this.playBtn.innerHTML = '<i class="ri-play-fill"></i>';
          this.progressBar.style.width = "0%";
          if (this.musicBtn) {
            this.musicBtn.classList.remove("active");
          }
        }

        updateDuration() {
          const duration = this.formatTime(this.audio.duration);
          this.durationEl.textContent = duration;
        }

        updateProgress() {
          const progress = (this.audio.currentTime / this.audio.duration) * 100;
          this.progressBar.style.width = `${progress}%`;
          this.currentTimeEl.textContent = this.formatTime(
            this.audio.currentTime,
          );
        }

        seek(e) {
          const rect = this.progressContainer.getBoundingClientRect();
          const percent = (e.clientX - rect.left) / rect.width;
          this.audio.currentTime = percent * this.audio.duration;
        }

        toggleMute() {
          this.isMuted = !this.isMuted;
          this.audio.muted = this.isMuted;
          this.volumeBtn.innerHTML = this.isMuted
            ? '<i class="ri-volume-mute-line"></i>'
            : '<i class="ri-volume-up-line"></i>';
        }

        formatTime(seconds) {
          if (isNaN(seconds)) return "0:00";
          const mins = Math.floor(seconds / 60);
          const secs = Math.floor(seconds % 60);
          return `${mins}:${secs.toString().padStart(2, "0")}`;
        }
      }

      // 初始化音频播放器
      document.addEventListener("DOMContentLoaded", () => {
        const audio = document.querySelector(".music-panel audio");
        if (audio) {
          new CustomAudioPlayer(audio);
        }

        // 点击面板外部关闭音乐面板
        document.addEventListener("click", (e) => {
          const panel = document.querySelector(".music-panel");
          const musicBtn = document.querySelector("#musicBtn");

          if (panel && musicBtn && panel.classList.contains("show")) {
            if (!panel.contains(e.target) && !musicBtn.contains(e.target)) {
              panel.classList.remove("show");
            }
          }
        });
      });
    </script>

    {{DECRYPTION_SCRIPT}}
  </body>
</html>
